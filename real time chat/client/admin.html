<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="admin-container">
    <header>
      <h2>Admin Dashboard</h2>
      <button id="logout-btn">Logout</button>
    </header>

    <section>
      <h3>Pending Approvals</h3>
      <div id="user-list" class="user-list"></div>
    </section>
  </div>

  <script>
    // Load pending users
    async function loadUsers() {
      try {
        const res = await fetch('/api/admin/unapproved');
        const users = await res.json();
        const container = document.getElementById('user-list');
        container.innerHTML = '';

        users.forEach(user => {
          const userCard = document.createElement('div');
          userCard.className = 'user-card';
          userCard.innerHTML = `
            <p><strong>Username:</strong> ${user.username}</p>
            <button onclick="approveUser('${user._id}')">Approve</button>
            <button onclick="deleteUser('${user._id}')">Delete</button>
          `;
          container.appendChild(userCard);
        });
      } catch (err) {
        console.error('Error loading users:', err);
      }
    }

    async function approveUser(username) {
      try {
        await fetch('/api/admin/approve', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        loadUsers();
      } catch (err) {
        console.error('Error approving user:', err);
      }
    }

    async function deleteUser(username) {
      try {
        await fetch('/api/admin/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        loadUsers();
      } catch (err) {
        console.error('Error deleting user:', err);
      }
    }

    document.getElementById('logout-btn').addEventListener('click', () => {
      fetch('/api/logout').then(() => {
        location.href = 'login.html';
      });
    });

    // Load users on page load
    window.addEventListener('DOMContentLoaded', loadUsers);
  </script>
</body>
</html>
